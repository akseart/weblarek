# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run dev
```

или

```
yarn
yarn dev
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`


#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

## Данные
### Интерфейс описания товара
Интерфейс используется для учета товаров, используемых в приложении
```typescript
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
} 

```

### Интерфейс описания покупателя
Интерфейс используется для учета покупателей, которые могут быть в приложении
```typescript
interface ICustomer {
    payment: TPayment;
    email: string;
    phone: string;
    address: string;
}
```

### Интерфейс описания данных валидации формы покупателя

```typescript
interface IValidationCustomerResult {
	isValid: boolean;
	errors: {
		payment?: string;
		address?: string;
		phone?: string;
		email?: string;
	};
}
```

### Тип оплаты
По ТЗ, способ оплаты может принимать значения “card” или “cash”
```typescript
type TPayment = 'card' | 'cash';
```
## Модели данных
### Класс Catalog
Класс предназначен для хранения данных о всех товарах
#### Поля данных
- `private products: IProduct[]` - массив всех товаров.
- `private selectedProduct: IProduct | null` - товар, выбранный для подробного отображения.

#### Методы
- `setProducts(products: IProduct[]): void` - сохранение массива товаров, полученного в параметрах метода.
- `getProducts(): IProduct[]` - получение массива товаров из модели.
- `getProductById(id: string): IProduct | undefined` - получение одного товара по его `id`.
- `setSelectedProduct(product: IProduct | null): void` - сохранение товара для подробного отображения.
- `getSelectedProduct(): IProduct | null` - получение товара для подробного отображения.


### Класс ShoppingCart
Класс предназначен для хранения и управления данными о текущей корзине товаров
#### Поля данных
- `private items: IProduct[]` - массив товаров, выбранных покупателем для покупки.

#### Методы
- `getItems(): IProduct[]` - получение массива товаров, которые находятся в корзине.
- `addItem(product: IProduct): void` - добавление товара, полученного в параметре, в массив корзины.
- `removeItem(product: IProduct): void` - удаление товара, полученного в параметре, из массива корзины.
- `clear(): void` - очистка корзины.
- `getTotalCost(): number` - получение стоимости всех товаров в корзине (сумма полей `price` всех товаров, принимая `null` как 0).
- `getCount(): number` - получение количества товаров в корзине.
- `hasItem(id: string): boolean` - проверка наличия товара в корзине по его `id`, полученному в параметре метода.

### Класс Customer
Класс предназначен для хранения и управления данными о покупателе

#### Поля данных
- `private payment: TPayment | null` - вид оплаты.
- `private address: string | null` - адрес.
- `private phone: string | null` - телефон.
- `private email: string | null` - email.

#### Методы
- `setData(data: Partial<IBuyer>): void` - сохранение данных в модели; позволяет сохранить только часть полей, не затирая остальные (например, только адрес или только телефон).
- `getData(): IBuyer` - получение всех данных покупателя.
- `clear(): void` - очистка данных покупателя.
- `validate(): IValidationResult` - валидация данных; поле валидно, если оно не пустое. Метод возвращает валидность и информацию об ошибке по каждому полю.

## Слой коммуникации
### Класс CommunicationAPI
Класс предназначен для взаимодействия с серверной частью приложения «веб-ларёк» посредством API запросов
#### Поля данных
- `api: IApi` - инстанс объекта, который реализовывает взаимодействие с API.
#### Методы
- `fetchProducts(): Promise<IProduct[]>` - получение списка товаров через API.
- `sendOrder(order: IOrderRequest): Promise<IOrderResponse>` - отправка запроса на получение покупки.

## Слой представления

### Класс `Gallery`

Класс предназначен для отображения каталога элементов на странице.
Управляет содержимым контейнера, заменяя текущие элементы новыми при обновлении каталога.

#### Поля данных

- `catalog: HTMLElement[]` — массив HTML-элементов, представляющих содержимое галереи.

#### Методы

- `constructor(container: HTMLElement)` — создаёт экземпляр компонента и привязывает его к указанному HTML-контейнеру.
- `set catalog(items: HTMLElement[])` — обновляет содержимое контейнера, заменяя существующие элементы переданным
  списком `items`.

### Класс `Header`

Класс предназначен для управления элементами шапки сайта, включая отображение счётчика корзины и обработку нажатия на
кнопку корзины.

#### Поля данных

- `counter: number` — количество товаров в корзине.
- `counterElement: HTMLElement` — элемент интерфейса, отображающий текущее значение счётчика.
- `cartButtonElement: HTMLButtonElement` — кнопка открытия корзины.

#### Методы

- `constructor(container: HTMLElement, events: IEvents)` — создаёт экземпляр шапки и инициализирует элементы DOM.  
  Добавляет обработчик клика на кнопку корзины, который инициирует событие `cart:open`.
- `set counter(value: number)` — обновляет отображаемое значение счётчика корзины.

### Класс `Cart`

Класс предназначен для управления отображением и поведением корзины покупок.  
Отвечает за вывод списка товаров, общей стоимости и обработку оформления заказа.

#### Поля данных

- `cartItems: HTMLElement[]` — массив HTML-элементов, представляющих товары в корзине.
- `price: number` — общая сумма товаров в корзине.
- `listElement: HTMLElement` — контейнер для списка элементов корзины.
- `priceElement: HTMLElement` — элемент для отображения общей стоимости.
- `acceptButton: HTMLButtonElement` — кнопка для оформления заказа.

#### Методы

- `constructor(container: HTMLElement, event: IEvents)` — создаёт экземпляр корзины и инициализирует её DOM-элементы.  
  Добавляет обработчик клика на кнопку оформления заказа, генерирующий событие `cart:order`.
- `set cartsItems(value: HTMLElement[])` — обновляет содержимое списка товаров корзины.
- `set price(value: number)` — устанавливает значение цены и отображает его в элементе `.basket__price`.
- `set acceptButtonState(value: boolean)` — изменяет состояние активности кнопки оформления заказа (`disabled`).
- `clear()` — очищает содержимое списка корзины.

### Класс `Modal`

Класс предназначен для управления модальным окном приложения.  
Обеспечивает открытие, закрытие и обновление содержимого модального окна, а также обработку событий взаимодействия
пользователя.

#### Поля данных

- `content: HTMLElement` — содержимое модального окна.
- `contentElement: HTMLElement` — DOM-элемент контейнера, в который вставляется содержимое модалки.
- `buttonClose: HTMLButtonElement` — кнопка для закрытия окна.

#### Методы

- `constructor(container: HTMLElement, events: IEvents)` — создаёт экземпляр модального окна, инициализирует
  DOM-элементы и добавляет обработчики событий:
  - Закрытие окна при клике на кнопку.
  - Закрытие окна при клике вне содержимого (по фону).  
    При срабатывании любого из этих событий создается событие `modal:close`.
- `set content(value: HTMLElement)` — обновляет содержимое модального окна и активирует отображение, добавляя
  класс `modal_active`.
- `close()` — закрывает модальное окно, удаляя класс `modal_active`.

### Класс `SuccessOrder`

Класс предназначен для отображения экрана успешного оформления заказа.  
Отвечает за показ итоговой стоимости списанных средств и обработку закрытия окна результата.

#### Поля данных

- `cost: number` — сумма, списанная за заказ.
- `descriptionElement: HTMLElement` — элемент, отображающий описание с итоговой стоимостью.
- `closeButton: HTMLButtonElement` — кнопка для закрытия окна успешного заказа.

#### Методы

- `constructor(container: HTMLElement, events: IEvents)` — создаёт экземпляр компонента, инициализирует DOM-элементы и
  добавляет обработчик клика на кнопку закрытия.  
  При нажатии на кнопку генерируется событие `successOrder:close`.
- `set cost(value: number)` — обновляет текст описания, отображая списанную сумму в
  формате `Списано {значение} синапсов`.

### Класс `BaseForm`

Абстрактный класс, предназначенный для базовой логики работы форм ввода данных.  
Определяет обработку ошибок, управление состоянием кнопки отправки и генерацию событий при изменении полей формы.

#### Поля данных

- `errors: string | null` — сообщение об ошибке, отображаемое под формой.
- `submitButtonState: boolean` — состояние кнопки отправки формы (активна или заблокирована).
- `errorsElement: HTMLElement` — DOM-элемент для вывода текста ошибок.
- `submitButton: HTMLButtonElement` — кнопка отправки формы.

#### Методы

- `constructor(container: HTMLElement, events: IEvents)` — создаёт экземпляр базовой формы, инициализируя DOM-элементы и
  связывая их с общими событиями приложения.
- `set errors(value: string | null)` — обновляет текст ошибки в интерфейсе.
- `set submitButtonState(value: boolean)` — меняет состояние активности кнопки отправки формы.
- `protected onFormChange(field: keyof ICustomer, value: string | null)` — уведомляет систему о том, что одно из полей
  формы изменилось, генерируя событие `form:change` с передачей имени поля и его значения.

### Класс `OrderForm`

**Родительский класс:** `BaseForm<IOrderForm>`

Класс предназначен для управления формой оформления заказа.  
Обрабатывает ввод адреса, выбор способа оплаты и отправку формы.

#### Поля данных

- `address: string` — адрес доставки заказа.
- `payment: 'cash' | 'card' | ''` — выбранный способ оплаты: наличными, картой или не выбран.
- `addressElement: HTMLInputElement` — поле ввода адреса.
- `cardPaymentButton: HTMLButtonElement` — кнопка выбора оплаты картой.
- `cashPaymentButton: HTMLButtonElement` — кнопка выбора оплаты наличными.

#### Методы

- `constructor(container: HTMLElement, events: IEvents)` — создаёт экземпляр формы заказа, инициализирует элементы DOM и
  навешивает обработчики:
  - Изменение поля адреса приводит к вызову `onFormChange('address', value)`.
  - Клик по кнопке оплаты картой устанавливает `payment` в `'card'`.
  - Клик по кнопке оплаты наличными устанавливает `payment` в `'cash'`.
  - Клик по кнопке отправки формы генерирует событие `formOrder:Submit`.
- `set payment(method: 'card' | 'cash' | '')` — визуально выделяет выбранный способ оплаты, добавляя или убирая
  класс `button_alt-active` у соответствующих кнопок.
- `set address(value: string)` — заполняет поле адреса указанным значением.
- `clear()` — сбрасывает форму: очищает поле адреса и снимает выделение со всех вариантов оплаты.

### Класс `ContactFrom`

**Родительский класс:** `BaseForm<IContactForm>`

Класс предназначен для управления формой контактных данных пользователя.  
Обрабатывает ввод email и телефона, а также отправку формы контактной информации.

#### Поля данных

- `email: string` — адрес электронной почты пользователя.
- `phone: string` — номер телефона пользователя.
- `emailInput: HTMLInputElement` — поле ввода email.
- `phoneInput: HTMLInputElement` — поле ввода телефона.

#### Методы

- `constructor(container: HTMLElement, events: IEvents)` — создаёт экземпляр формы контактов, инициализирует элементы
  DOM и добавляет обработчики:
  - Изменение email вызывает `onFormChange('email', value)`.
  - Изменение телефона вызывает `onFormChange('phone', value)`.
  - Клик по кнопке отправки формы предотвращает стандартную отправку и генерирует событие `formContacts:submit`.
- `set email(value: string)` — устанавливает значение поля email.
- `set phone(value: string)` — устанавливает значение поля телефона.
- `clear()` — очищает значения полей ввода контактных данных.

### Класс `Card<T extends ICardData>`

**Родительский класс:** `Component<T>`

Абстрактный класс, предназначенный для отображения карточки товара или другого элемента каталога.  
Определяет базовые свойства и поведение для вывода заголовка и цены карточки.

#### Поля данных

- `title: string` — заголовок карточки (например, название товара).
- `price: number | null` — цена товара в синапсах или `null`, если товар бесценен.
- `titleElement: HTMLElement` — элемент DOM для отображения заголовка карточки.
- `priceElement: HTMLElement` — элемент DOM для отображения цены карточки.

#### Методы

- `constructor(container: HTMLElement)` — инициализирует карточку, находит элементы заголовка и цены внутри переданного
  контейнера.
- `set price(value: number | null)` — устанавливает текст цены:
  - при наличии значения выводит строку вида `{value} синапсов`;
  - при значении `null` выводит текст `"Бесценно"`.
- `set title(value: string)` — устанавливает текст заголовка карточки.

### Класс `CardWithMeta<T extends ICardData>`

**Родительский класс:** `Card<T>`

Абстрактный класс, расширяющий базовую карточку товара дополнительными метаданными.  
Отвечает за отображение изображения товара и категории с соответствующим оформлением.

#### Поля данных

- `image: string | undefined` — URL изображения товара, которое отображается в карточке.
- `category: string` — категория товара, влияющая на текст и оформление карточки.
- `imageElement: HTMLImageElement` — DOM-элемент изображения товара.
- `categoryElement: HTMLElement` — DOM-элемент для отображения категории товара.

#### Методы

- `protected constructor(container: HTMLElement)` — инициализирует карточку с метаданными, находит элементы изображения
  и категории внутри контейнера.
- `set image(src: string | undefined)` — устанавливает изображение товара, если передан непустой URL, используя
  метод `setImage`.
- `set category(value: string)` — устанавливает текст категории в элементе `.card__category`, а также:
  - удаляет ранее назначенные классы категорий, определённые в `categoryMap`;
  - добавляет класс, соответствующий текущему значению категории.

### Класс `CardCatalog`

**Родительский класс:** `CardWithMeta<TCardCatalog>`

Класс предназначен для отображения карточки товара в каталоге.  
Использует категорию и изображение товара и позволяет навешивать обработчик клика по карточке.

#### Поля данных

- Наследует все поля от `CardWithMeta<TCardCatalog>`, включая `image` и `category`.

#### Методы

- `constructor(container: HTMLElement, actions?: ICardActions)` — создаёт экземпляр карточки каталога и инициализирует
  метаданные товара.  
  Если передан обработчик `actions.onClick`, добавляет его на событие `click` по контейнеру карточки.

### Класс `CardPreview`

**Родительский класс:** `CardWithMeta<TDataCardPreview>`

Класс предназначен для отображения детальной карточки товара в превью (например, в модальном окне).  
Отвечает за вывод описания товара и управление кнопкой добавления в корзину.

#### Поля данных

- `description: string` — текстовое описание товара.
- `descriptionElement: HTMLElement` — DOM-элемент для отображения описания товара.
- `addButtonElement: HTMLButtonElement` — кнопка добавления товара в корзину.

#### Методы

- `constructor(container: HTMLElement, events: EventEmitter)` — создаёт карточку превью товара, инициализирует элементы
  описания и кнопку добавления.  
  При клике на кнопку добавления генерирует событие `cart:add`.
- `set description(value: string)` — устанавливает текст описания товара.
- `set addButtonState(value: boolean)` — управляет доступностью кнопки добавления в корзину, блокируя её при
  значении `true`.

### Класс `CardCompact`

**Родительский класс:** `Card<ICardCompactData>`

Класс предназначен для отображения компактной карточки товара в корзине.  
Отображает порядковый номер товара и позволяет навешивать обработчик удаления элемента.

#### Поля данных

- `index: number` — порядковый номер товара в корзине.
- `itemIndexElement: HTMLElement` — DOM-элемент для отображения номера позиции.
- `deleteButton: HTMLButtonElement` — кнопка для удаления товара из корзины.

#### Методы

- `constructor(container: HTMLElement, actions: ICardActions)` — создаёт компактную карточку товара, инициализирует
  элементы DOM и настраивает поведение кнопки удаления.  
  При нажатии на кнопку, если передан обработчик `actions.onDelete`, он добавляется как обработчик события `click` для
  удаления товара.
- `set index(value: number)` — устанавливает и отображает порядковый номер товара в корзине.

## События приложения

В этом разделе описаны пользовательские события, которые генерируются компонентами интерфейса.  
События используются как контракт взаимодействия между View, Presenter и Model.

### Каталог

- `catalog:changed`  
  Генерируется методом `setProducts(products: IProduct[])`.  
  Означает, что список товаров каталога полностью обновлён (например, после загрузки данных с сервера) и представление
  должно перерисовать каталог.

### Навигация и корзина

- `cart:open`  
  Генерируется классом `Header` при клике по кнопке корзины.  
  Используется для открытия модального окна корзины и отображения списка товаров.

- `cart:add`  
  Генерируется классом `CardPreview` при клике по кнопке добавления товара.  
  Означает запрос на добавление текущего товара в корзину.

- `cart:order`  
  Генерируется классом `Cart` при клике по кнопке оформления заказа в корзине.  
  Используется для перехода от отображения корзины к форме оформления заказа.

- `cart:changed`  
  Генерируется в следующих случаях:
  - методом `addItem(product: IProduct)` — при добавлении товара в корзину;
  - методом `removeItem(product: IProduct)` — при удалении товара из корзины;
  - методом `clear()` — при полном очищении корзины.

  Используется для:
  - пересчёта общей стоимости заказа;
  - обновления счётчика товаров в шапке (`Header`);
  - обновления списка товаров в компоненте `Cart`.

### Модальные окна

- `modal:close`  
  Генерируется классом `Modal` в двух случаях:
  - при клике по кнопке закрытия модального окна;
  - при клике по фону (оверлею) вокруг содержимого модалки.  
    Используется для скрытия модального окна и сброса его состояния.

### Оформление заказа

- `formOrder:Submit`  
  Генерируется классом `OrderForm` при клике по кнопке отправки формы заказа.  
  Обычно ведёт к валидации данных заказа и переходу к следующему шагу (форма контактов или отправка на сервер).

- `formContacts:submit`  
  Генерируется классом `ContactFrom` при клике по кнопке отправки формы контактов.  
  Предварительно предотвращает стандартную отправку формы (`event.preventDefault()`), затем сигнализирует
  Presenter/Model о готовности контактных данных.

- `successOrder:close`  
  Генерируется классом `SuccessOrder` при клике по кнопке закрытия окна успешного заказа.  
  Используется для закрытия модального окна с результатом и возврата пользователя к каталогу или другому экрану.

### Изменение полей форм

Во всех формах изменения полей прокидываются через базовый метод `onFormChange`, реализованный в `BaseForm`.

- `form:change`  
  Генерируется `BaseForm` при изменении значений полей в дочерних формах.  
  В payload передаётся объект `{ field, value }`, где:
  - `field` — имя изменяемого поля (например, `'address'`, `'payment'`, `'email'`, `'phone'`);
  - `value` — новое значение поля.

## Презентер

Презентер реализован в файле `main.ts` и описывает, как слои **Model** и **View** взаимодействуют
через `EventEmitter`. Он инициализирует модели (каталог, корзину, покупателя), представления (шапка, галерея,
модалка, формы, корзина, карточки) и слой работы с API, а также подписывается на события, возникающие в
интерфейсе.

Через цепочку событий презентер организует полный сценарий работы страницы: загрузку каталога, выбор товара, добавление
и удаление из корзины, переход между формами заказа и контактов, валидацию введённых данных и отправку заказа на сервер
с последующим показом окна успеха и сбросом состояния приложения